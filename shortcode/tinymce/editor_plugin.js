(function(){tinymce.PluginManager.requireLangPack('mueventsshortcode');tinymce.create('tinymce.plugins.MUEventsShortcode',{init:function(ed,url){var t=this;this.plugin_url=url;ed.addCommand('muEventInsert',function(params){if(params==false)params="";else params='?params='+params;ed.windowManager.open({file:url+'/muEvent_editorDialog.php'+params,width:340+ed.getLang('mueventsshortcode.delta_width',0),height:340+ed.getLang('mueventsshortcode.delta_height',0),inline:1,popup_css:false},{plugin_url:url})});ed.addButton('mueventsshortcode',{title:ed.getLang('mueventsshortcode.desc'),'class':'mueventsshortcode',cmd:'muEventInsert',image:url+'../../../images/mu_events_mce_icon_up.png'});ed.onDblClick.add(function(ed,e){if(e.target.nodeName=='IMG'&&ed.dom.hasClass(e.target,'muEventMCE')){tinyMCE.activeEditor.execCommand('muEventInsert',tinymce.trim(e.target.title))}});ed.onBeforeSetContent.add(function(ed,o){o.content=t._mod_content(o.content,url)});ed.onPostProcess.add(function(ed,o){if(o.get)o.content=t._get_eventlisting(o.content)})},_mod_content:function(co,url){return co.replace(/\[mu-events([^\]]*)\]/g,function(a,b){return'<img src="'+url+'../../../images/mu_events_mce_placeholder_icon.png" class="muEventMCE mceItem" style="cursor:pointer;cursor:hand;" title="mu-events'+tinymce.DOM.encode(b)+'" />'})},_get_eventlisting:function(co){function getAttr(s,n){n=new RegExp(n+'=\"([^\"]+)\"','g').exec(s);return n?tinymce.DOM.decode(n[1]):''};return co.replace(/(?:<p[^>]*>)*(<img[^>]+>)(?:<\/p>)*/g,function(a,im){var cls=getAttr(im,'class');if(cls.indexOf('muEventMCE')!=-1)return'<p>['+tinymce.trim(getAttr(im,'title'))+']</p>';return a})},createControl:function(n,cm){return null},getInfo:function(){return{longname:'accessible_media',author:'aut0poietic',authorurl:'http://aut0poietic.us',infourl:'http://aut0poietic.us',version:"1.0"}}});tinymce.PluginManager.add('mueventsshortcode',tinymce.plugins.MUEventsShortcode)})();